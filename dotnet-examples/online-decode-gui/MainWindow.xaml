<Window x:Class="SherpaOnnxASR.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Sherpa Live Captions" Height="150" Width="700"
        WindowStyle="None" AllowsTransparency="True" Background="#CC000000"
        Topmost="True" ResizeMode="CanResizeWithGrip"
        MouseDown="Window_MouseDown">
    
    <Window.Resources>
        <Style x:Key="DarkComboBox" TargetType="ComboBox">
            <Setter Property="Background" Value="#444"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Background="{TemplateBinding Background}"
                                          BorderThickness="0"
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="3">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition/>
                                                    <ColumnDefinition Width="20"/>
                                                </Grid.ColumnDefinitions>
                                                <ContentPresenter Grid.Column="0"/>
                                                <Path Grid.Column="1" Data="M0,0 L4,4 L8,0" Stroke="White" StrokeThickness="1.5" 
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="ContentSite"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              Margin="5,3,23,3"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                              IsHitTestVisible="False"/>
                            <Popup x:Name="Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True" Focusable="False" PopupAnimation="Slide">
                                <Border Background="#333" BorderBrush="#555" BorderThickness="1" CornerRadius="3"
                                        MaxHeight="{TemplateBinding MaxDropDownHeight}" MinWidth="{TemplateBinding ActualWidth}">
                                    <ScrollViewer>
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="ComboBoxItem">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="5,3"/>
            <Style.Triggers>
                <Trigger Property="IsHighlighted" Value="True">
                    <Setter Property="Background" Value="#555"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Row 0: Status and Controls -->
        <Border Grid.Row="0" BorderBrush="#33FFFFFF" BorderThickness="0,0,0,1" Padding="0,0,0,5">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock x:Name="StatusText" Text="Model: None" Foreground="#AAA" VerticalAlignment="Center" Margin="0,0,15,0"/>
                
                <Button x:Name="SettingsBtn" Content="⚙ Settings" Click="SettingsBtn_Click" Margin="0,0,5,0" Padding="10,2" Background="#444" Foreground="White" BorderThickness="0"/>
                
                <ComboBox x:Name="AudioInputCombo" Width="140" Margin="0,0,5,0" 
                          SelectionChanged="AudioInputCombo_SelectionChanged"
                          Style="{StaticResource DarkComboBox}"/>
                
                <!-- Level Meter -->
                <Border Background="#222" Width="60" Height="16" VerticalAlignment="Center" Margin="0,0,5,0" CornerRadius="2">
                    <Grid>
                        <Rectangle x:Name="LevelBar" Fill="LimeGreen" HorizontalAlignment="Left" Width="0" Height="16" RadiusX="2" RadiusY="2"/>
                        <TextBlock x:Name="LevelText" Text="-60dB" Foreground="White" FontSize="10" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>
                </Border>
                <TextBlock Text="MaxChars:" Foreground="#888" VerticalAlignment="Center" Margin="0,0,2,0"/>
                <TextBox x:Name="MaxLenBox" Text="2000" Width="40" Margin="0,0,10,0" Background="#333" Foreground="White" ToolTip="Max Chars"/>
                
                <Button x:Name="ControlBtn" Content="▶ Start" Click="ControlBtn_Click" Padding="10,2" Background="#555" Foreground="#888" BorderThickness="0" IsEnabled="False"/>
                
                <Button Content="X" Click="CloseBtn_Click" Margin="10,0,0,0" Background="Transparent" Foreground="Red" BorderThickness="0" FontWeight="Bold"/>
            </StackPanel>
        </Border>

        <!-- Row 1: Caption Area -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden" Margin="0,10,0,0" x:Name="ScrollArea">
            <TextBlock x:Name="CaptionText" 
                       Text="Open Settings to load model, then click Start." 
                       Foreground="White" 
                       FontSize="16" 
                       FontFamily="Segoe UI" 
                       TextWrapping="Wrap"
                       TextAlignment="Left"
                       VerticalAlignment="Top"
                       LineHeight="22"/>
        </ScrollViewer>
    </Grid>
</Window>